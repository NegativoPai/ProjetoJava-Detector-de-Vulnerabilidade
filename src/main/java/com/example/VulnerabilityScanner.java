package main.java.com.example;

import org.apache.hc.client5.http.fluent.Request;
import org.apache.hc.core5.http.ParseException;

import java.io.IOException;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.List;

public class VulnerabilityScanner{
    
    private static final String ZAP_API_URL = "http://localhost:8080/JSON/ascan/action/";
    private static final String API_TOKEN = "q4o6kjspo42sk2h58n59go7cbp";

    public static List<String> scanwithOWASPZAP(String url){
        List<String> vulnerabilities = new ArrayList<>();

        try{
            String scanUrl = ZAP_API_URL + "scan/?apikey=" + API_TOKEN + "&url=" + URLEncoder.encode(url, StandardCharsets.UTF_8) + "&recurse=true";

            String startScanResponse = Request.get(scanUrl) .connectTimeout(5000) .execute() .returnContent() .asString();

            Thread.sleep(5000);

            String resultUrl = "http://localhost:8080/JSON/ascan/view/scans/?apikey=" + API_TOKEN;
            String resultResponse = Request.get(resultUrl) .connectTimeout(5000) .execute() .returnContent() .asString();

            vulnerabilities.add("Resultado do ZAP: " + resultResponse);
        } catch (IOException | InterruptedException e) {

            vulnerabilities.add("Erro ao usar o OWASP ZAP: " + e.getMessage());
        }

        return vulnerabilities;
    }
}